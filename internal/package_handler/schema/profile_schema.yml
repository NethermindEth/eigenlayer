$schema: "http://json-schema.org/draft-07/schema#"
# Definitions of all type of Option
definitions:
  OptionInt:
    type: object
    properties:
      name:
        type: string
      target:
        type: string
      help:
        type: string
      type:
        const: "int"
      default:
        type: integer
      validate:
        type: object
        properties:
          min_value:
            type: integer
          max_value:
            type: integer
        required:
          - min_value
          - max_value
        additionalProperties: false
    required:
      - name
      - target
      - help
      - type
    additionalProperties: false 
  OptionString:
    type: object
    properties:
      name:
        type: string
      target:
        type: string
      help:
        type: string
      type:
        const: "str"
      default:
        type: string
      validate:
        type: object
        properties:
          re2_regex:
            type: string
        required:
          - re2_regex
        additionalProperties: false 
    required:
      - name
      - target
      - help
      - type
    additionalProperties: false
  OptionFloat:
    type: object
    properties:
      name:
        type: string
      target:
        type: string
      help:
        type: string
      type:
        const: "float"
      default:
        type: number
      validate:
        type: object
        properties:
          min_value:
            type: number
          max_value:
            type: number
        required:
          - min_value
          - max_value
        additionalProperties: false
    required:
      - name
      - target
      - help
      - type
    additionalProperties: false
  OptionBool:
    type: object
    properties:
      name:
        type: string
      target:
        type: string
      help:
        type: string
      type:
        const: "bool"
      default:
        type: boolean
    required:
      - name
      - target
      - help
      - type
    additionalProperties: false
  OptionPathDir:
    type: object
    properties:
      name:
        type: string
      target:
        type: string
      help:
        type: string
      type:
        const: "path_dir"
      default:
        type: string
    required:
      - name
      - target
      - help
      - type
    additionalProperties: false
  OptionPathFile:
    type: object
    properties:
      name:
        type: string
      target:
        type: string
      help:
        type: string
      type:
        const: "path_file"
      default:
        type: string
      validate:
        type: object
        properties:
          format:
            type: string
        required:
          - format
        additionalProperties: false 
    required:
      - name
      - target
      - help
      - type
    additionalProperties: false
  OptionURI:
    type: object
    properties:
      name:
        type: string
      target:
        type: string
      help:
        type: string
      type:
        const: "uri"
      default:
        type: string
      validate:
        type: object
        properties:
          uri_scheme:
            type: array
            minItems: 1
            items:
              type: string
        required:
          - uri_scheme
        additionalProperties: false 
    required:
      - name
      - target
      - help
      - type
    additionalProperties: false
  OptionSelect:
    type: object
    properties:
      name:
        type: string
      target:
        type: string
      help:
        type: string
      type:
        const: "select"
      default:
        type: string
      validate:
        type: object
        properties:
          options:
            type: array
            minItems: 1
            items:
              type: string
        required:
          - options
        additionalProperties: false 
    required:
      - name
      - target
      - help
      - type
    additionalProperties: false
  OptionPort:
    type: object
    properties:
      name:
        type: string
      target:
        type: string
      help:
        type: string
      type:
        const: "port"
      default:
        type: integer
        minumum: 1
        maximum: 65535
    required:
      - name
      - target
      - help
      - type
    additionalProperties: false
  OptionID:
    type: object
    properties:
      name:
        type: string
      target:
        type: string
      help:
        type: string
      type:
        const: "id"
      default:
        type: string      
    required:
      - name
      - target
      - help
      - type
    additionalProperties: false

# Profile Schema
type: object
properties:
  name:
    type: string
  hardware_requirements_overrides:
    type: object
    properties:
      min_cpu_cores:
        type: integer
        minimum: 0
      min_ram:
        type: integer
        minimum: 0
      min_free_space:
        type: integer
        minimum: 0
      stop_if_requirements_are_not_met:
        type: boolean
    required:
    - min_cpu_cores
    - min_ram
    - min_free_space
    - stop_if_requirements_are_not_met
    additionalProperties: false
  plugin_overrides:
    type: object
    properties:
      image:
        type: string
    required:
    - image
    additionalProperties: false
  options:
    type: array
    items:
      oneOf:
        - $ref: '#/definitions/OptionInt'
        - $ref: '#/definitions/OptionString'
        - $ref: '#/definitions/OptionFloat'
        - $ref: '#/definitions/OptionBool'
        - $ref: '#/definitions/OptionPathDir'
        - $ref: '#/definitions/OptionPathFile'
        - $ref: '#/definitions/OptionURI'
        - $ref: '#/definitions/OptionSelect'
        - $ref: '#/definitions/OptionPort'
        - $ref: '#/definitions/OptionID'
  monitoring:
    type: object
    properties:
      targets:
        type: array
        items:
          type: object
          properties:
            service:
              type: string
            port:
              type: integer
              minumum: 1
              maximum: 65535
            path:
              type: string
          required:
          - service
          - path
          - port
          additionalProperties: false
    required:
      - targets
    additionalProperties: false
  api:
    type: object
    properties:
      service:
        type: string
      port:
        type: integer
        minumum: 1
        maximum: 65535
    required:
    - service
    - port
    additionalProperties: false
required:
  - monitoring
additionalProperties: false